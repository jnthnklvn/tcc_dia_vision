\chapter{Desenvolvimento do DiaVision}
\label{ch:development}

Neste capítulo são apresentadas as tecnologias utilizadas, as soluções adotadas para os problemas
de acessibilidade identificados no MSL e os resultados alcançados ao final do processo desenvolvimento.

\section{Tecnologias Utilizadas}

Esta seção lista as principais tecnologias e recursos utilizados no desenvolvimento do sistema DiaVision.

\subsection{Visual Studio Code}

O Visual Studio Code (VSCode) é um editor de código \emph{open source} desenvolvido pela Microsoft para Windows, Linux e MacOS.
Ele inclui suporte para depuração, controle de versionamento Git incorporado, realce de sintaxe, IntelliSense
- termo para um conjunto de funcionalidades de edição de código, tais como completar código e informações de parâmetros -
e refatoração de código.

O VSCode também possibilita a instalação de extensões que adicionam funcionalidades ao editor, assim, aumentando a produtividade do desenvolvedor.
Por conta dessas características, esse foi o editor utilizado neste projeto tanto para desenvolver o sistema DiaVision quanto para a parte escrita deste trabalho.

As extensões utilizadas para desenvolvimento da aplicação foram: Flutter e Dart, que dão suporte à criação de aplicações com o SDK do Flutter
e fluttermobx, que oferece atalhos para adicionar componentes de gerenciamento do estado da aplicação. Já Para a parte escrita,
foi utilizado o conjunto de extensões: bibtexLanguage, Code Speell Checker, LaTeX e LaTeX Workshop.

\newpage

\subsection{Github}

O Github é uma plataforma de desenvolvimento e gestão de código-fonte, baseada no Git, que permite aos usuários compartilhar seus projetos e arquivos com controle
de versionamento de código. Com isso é possível realizar \emph{commits}, sendo cada \emph{commit} um ponto de alteração no histórico do
projeto, criar \emph{branches}, ramificações que possibilitam trabalhar em diferentes funcionalidades ao mesmo tempo e realizar \emph{merges},
que é processo de unir ramificações.

O versionamento de código é uma das funcionalidades mais importantes do Git, pois, manter o histórico de alterações
facilita a investigação e resolução de problemas e, em caso de falhas em uma versão do projeto, é possível reverter para uma
versão anterior.

O Github é gratuito e permite a criação de projetos públicos e privados, porém, os repositórios privados possuem limitações
nas funcionalidades da plataforma. Ambos os repositórios, do desenvolvimento do DiaVision\footnote{\url{https://github.com/jnthnklvn/dia_vision}}
e da parte escrita com LaTeX\footnote{\url{https://github.com/jnthnklvn/tcc_dia_vision}} subiram para o GitHub,
inicialmente de forma privada e disponibilizados de forma pública após a finalização deste trabalho.

\subsection{Ambiente de Desenvolvimento}

A máquina principal utilizada para desenvolvimento do sistema DiaVision foi um computador de mesa (do inglês \emph{Desktop}), com o SO Windows 11.
Porém, trata-se do desenvolvimento de uma aplicação multiplataforma e não é possível testar a aplicação para o sistema operacional
iOS, da Apple, em um computador que não seja esteja rodando o macOS. Assim, para validação do aplicativo, também foi
utilizado um MacBook.

O \autoref{qua-esp-maq-gui} mostra as especificações das máquinas utilizadas no desenvolvimento do sistema.

\begin{quadro}[htb!]
    \begin{center}
        \ABNTEXfontereduzida
        \caption{\label{qua-esp-maq-gui}Máquinas de Desenvolvimento.}
        \begin{tabular}{|c|c|c|}
            %\hline
            \hline
                                & \textbf{\emph{Desktop}}  & \textbf{MacBook}        \\
            \hline
            Sistema Operacional & Windows 11 Pro 22H2      & macOS Big Sur 11.3.1    \\
            \hline
            Disco Rígido        & SDD NVMe 512GB e HD 1TB  & 256GB SDD               \\
            \hline
            Memória RAM         & 32GB 3000MHz DDR4        & 8GB 1600MHz DDR3        \\
            \hline
            Processador         & AMD Ryzen 5 5600X 6-Core & Intel Core i5 Dual-Core \\
            \hline
            % \hline
        \end{tabular}
        \legend{Fonte: Autor.}
    \end{center}
\end{quadro}

\newpage

\subsection{Dispositivos de Teste}

Os testes e validações da aplicação, durante o processo de desenvolvimento, foram realizados em dispositivos físicos
rodando o SO Android, porém, para o iOS os testes foram realizados por meio do iOS Simulator, disponível apenas em
computadores com o SO macOS.

Assim, o \autoref{qua-esp-smart} apresenta as especificações dos \emph{smartphones} utilizados durante o desenvolvimento
do aplicativo.

\begin{quadro}[htb!]
    \begin{center}
        \ABNTEXfontereduzida
        \caption{\label{qua-esp-smart}\emph{Smartphones} utilizados no Desenvolvimento.}
        \begin{tabular}{|c|c|c|}
            %\hline
            \hline
                                  & \textbf{Galaxy S20} & \textbf{Redmi Note 8}   \\
            \hline
            Marca                 & Samsung             & Xiaomi                  \\
            \hline
            Sistema Operacional   & Android 12          & Android 9.0             \\
            \hline
            Armazenamento Interno & 128GB               & 32GB                    \\
            \hline
            Memória RAM           & 8GB                 & 3GB                     \\
            \hline
            \emph{Chipset}        & SAMSUNG Exynos 990  & Snapdragon 665 Qualcomm \\
            \hline
            % \hline
        \end{tabular}
        \legend{Fonte: Autor.}
    \end{center}
\end{quadro}

\subsection{Back4app}

O Back4app é uma plataforma gratuita (no plano básico) que segue o modelo de serviço em nuvem \emph{Backend} como Serviço (BaaS, do inglês \emph{Backend as a Service})
para desenvolvimento de \emph{backend} e gerenciamento de infraestrutura com eficiência e facilidade. Com a plataforma é possível
criar estruturas de dados e serviços de forma simples, sem a necessidade de codificação, possibilitando também a adição de código por meio de \emph{Cloud
    Functions}\footnote{Com Funções em Nuvem é possível escrever funções simples que são disparadas a partir de eventos emitidos
    pela infraestrutura e serviços de nuvem.} para criar validações ou funcionalidades mais complexas.

A plataforma é baseada no ParsePlatform, um \emph{framework} de código aberto que fornece um conjunto de SDKs que visam a criação rápida de \emph{backends}
com armazenamentos de objetos e arquivos, autenticação de usuário, \emph{push notifications}, \emph{dashboard} para gerenciamento e integração com aplicações móveis e \emph{web}.

O Back4app também disponibiliza a criação, customização e hospedagem de uma aplicação \emph{web} para administração do sistema.
Sendo possível definir as classes e operações que estarão disponíveis para gerenciamento pelo Administrador do Sistema (ADS).

Devido a simplicidade que o Back4app oferece para criação, gerenciamento e hospedagem de \emph{backend}, comparado
à aplicações convencionais desenvolvidas por meio da codificação, e ao foco deste trabalho, que é o
desenvolvimento da aplicação móvel com o foco na usabilidade, esse foi o serviço escolhido para o desenvolvimento do sistema.

O plano utilizado para o serviço foi o gratuito, que possui limite de 10 mil requisições por mês, 250MB para armazenamento de dados,
1GB para transferência de dados, 1GB para armazenamento de arquivos e 1 \emph{Cloud Code Job}\footnote{\emph{Cloud Jobs} são utilizados
    para execução de funções de longa duração, das quais não é necessário aguardar a resposta, no servidor. Em outras soluções é possível
    executar essas funções periodicamente, porém, essa funcionalidade ainda não está disponível no Back4app e elas precisam ser disparadas
    por meio da API Rest.}.

\subsection{Flutter}

O \emph{framework} escolhido para desenvolvimento do aplicativo móvel foi o Flutter, apresentado no Capítulo \ref{ch:fundament},
devido a sua facilidade no desenvolvimento móvel multiplataforma, possibilitando a geração de aplicações
para Android e iOS a partir de uma base de código única, mantendo desempenho próximo ao de aplicações nativas.

\section{Implementação}

Esta seção detalha as soluções de implementação adotadas, tais como a arquitetura do sistema e as soluções
para os problemas de acessibilidade.

\subsection{Arquitetura}

A estrutura de pastas do projeto está organizada em módulos, os quais não conhecem uns aos outros,
apenas as classes relativas ao próprio módulo estão dentro de cada pasta. A exceção é para os \emph{repositories} (repositórios)
que estão numa camada separada e contém os modelos e as conexões com a fonte de dados.
Essa camada não tem conhecimento a respeito das demais camadas da aplicação.

Dentro de cada módulo estão as outras duas camadas, os \emph{controllers} (controladores) e a \emph{view} (interface visual).
Os \emph{controllers} fazem a mediação entre a \emph{view} e os \emph{repositories}, eles controlam o estado da aplicação,
devendo atualizar a \emph{view} quando receber atualização dos \emph{repositories} e chamar os \emph{repositories}
quando determinados eventos são disparados na \emph{view}.

A \autoref{fig_est_proj} mostra como está organizada essa estrutura de pastas, sendo que a \emph{view}
está divida em \emph{pages}, que são as telas e \emph{widgets}, que são os componentes que fazem parte das telas.

\newpage

\begin{figure}[htb]
    \caption{\label{fig_est_proj}Estrutura de Pastas do Projeto.}
    \begin{center}
        \includegraphics[scale=1]{Imagens/desenvolvimento/arquitetura_dia_vision.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

Ainda na \autoref{fig_est_proj} percebe-se que dentro de cada módulo existe uma classe geral, é nela onde são definidas
as rotas, injeções de dependências e \emph{singletons}\footnote{\emph{Singleton} é um padrão de projeto que garante
    a existência de apenas uma instância de uma classe.} de cada módulo, como mostra a \autoref{fig_mod_app_vis}.

\newpage

\begin{figure}[htb]
    \caption{\label{fig_mod_app_vis}Classe Principal do Módulo.}
    \begin{center}
        \includegraphics[scale=0.7]{Imagens/desenvolvimento/app_visao_module.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

Os \emph{singletons} dos repositórios são injetados nos construtores dos controladores como mostrado nas linhas 15
e 16 da \autoref{fig_mod_app_vis} e recuperados pelos controladores conforme mostrado na \autoref{fig_con_app_vis}.

\begin{figure}[htb]
    \caption{\label{fig_con_app_vis}Recuperar Injeção do \emph{Repository} no \emph{Controller}.}
    \begin{center}
        \includegraphics[scale=0.9]{Imagens/desenvolvimento/app_visao_controller.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

Já os \emph{singletons} dos controladores, por sua vez, são recuperados nas telas,
como nota-se na linha 24 da \autoref{fig_pag_app_vis}.

\begin{figure}[htb]
    \caption{\label{fig_pag_app_vis}Recuperar \emph{Controller} na \emph{Page}.}
    \begin{center}
        \includegraphics[scale=0.9]{Imagens/desenvolvimento/app_visao_page.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

\subsection{\emph{Backend}}

O Back4app foi escolhido para o \emph{backend} do sistema e com ele foi possível definir a estrutura de dados, que pode
ser vista na \autoref{fig_bac_app_data}, graficamente por meio de sua interface de usuário.

\begin{figure}[htb]
    \caption{\label{fig_bac_app_data}Esquema do Banco de Dados.}
    \begin{center}
        \includegraphics[scale=1.1]{Imagens/desenvolvimento/back4app_database.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

Embora a plataforma utilize um banco de dados NoSQL - banco de dados não relacional -, o esquema de dados
é definido de forma relacional, onde classes representam tabelas e os relacionamentos são definidos com a utilização
de ponteiros que apontam para objetos de outras classes. Assim, unindo o maior desempenho possibilitado por uma
estrutura NoSQL com uma visão relacional do esquema de dados em alto nível.

\newpage

\subsubsection{Classes do Banco de Dados}

A \autoref{fig_back_data_ali} apresenta a classe ``Alimentacao'' como exemplo, cada classe no banco, por padrão,
possui os atributos objectId, que é utilizado para referenciar os objetos em outras classes por
meio de ponteiros, createdAt, que é a data de criação do objeto, updatedAt, que é a data da última atualização
do objeto, e ACL\footnote{Lista de Controle de Acesso (ACL, do inglês \emph{\textit{Access Control List}})
    são regras de acesso definidas para cada objeto na sua criação.}, que define qual usuário tem permissão de acesso a
esse objeto e quais são essas permissões (escrita, leitura ou ambos).

Com isso, visando a segurança dos dados dos usuários, todas as classes que registram dados dos pessoais
possuem restrição de ACL, onde somente o próprio usuário possui permissão tanto de leitura quanto de escrita.

\begin{figure}[htb]
    \caption{\label{fig_back_data_ali}Exemplo de Classe no Banco.}
    \begin{center}
        \includegraphics[scale=0.63]{Imagens/desenvolvimento/back4app_database_alimentacao.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

Ainda na \autoref{fig_back_data_ali}, percebe-se que a classe ``Alimentacao'' possui um atributo chamado paciente do tipo
\emph{Pointer} (Ponteiro) que armazena o objectId que faz referencia à classe Paciente como uma chave estrangeira em
bancos de dados relacionais.

\newpage

\subsubsection{\emph{Dashboard} do Administrador do Sistema}

O Back4app também possibilitou a construção de um \emph{dashboard web} para gerenciamento das informações que são disponibilizadas
para os usuários no aplicativo, atendendo aos requisitos funcionais do Administrador do Sistema, mencionados no \autoref{qua-req-fun}.

A customização e disponibilização das funcionalidades nesse \emph{dashboard} foi feita utilizando a própria
interface da plataforma, onde foi possível definir as funcionalidades, campos e perfis acesso que estariam
disponíveis. Ao habilitar o \emph{dashboard} e realizar as customizações, são criadas novas classes no banco
de dados, como pôde ser observado nas que iniciam com "B4a" na \autoref{fig_back_data_ali}, que mantém salvas
essas configurações.

A \autoref{fig_back_dash_auth} apresenta a página de autenticação e a \emph{URL}\footnote{Localizador Uniforme de Recursos 
(URL, do inglês \emph{Uniform Resource Locator}), se refere ao endereço que permite que um site ou recurso seja encontrado na rede.}
de acesso, sendo que as credenciais para autenticar-se são as mesmas utilizadas no aplicativo, porém, com um ACL específico de acesso ao \emph{dashboard}.

\begin{figure}[htb]
    \caption{\label{fig_back_dash_auth}Tela de \emph{Login} do \emph{Dashboard}.}
    \begin{center}
        \includegraphics[scale=0.65]{Imagens/desenvolvimento/auth_admin.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

\newpage

Na \autoref{fig_back_dash_apps} é possível visualizar a tela inicial do \emph{dashboard} com as classes
que estão disponíveis para gerenciamento no menu lateral esquerdo.

\begin{figure}[htb]
    \caption{\label{fig_back_dash_apps}\emph{Dashboard} do Administrador do Sistema.}
    \begin{center}
        \includegraphics[scale=0.39]{Imagens/desenvolvimento/apps_visao_admin.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

Assim, a classe ``Apps de Visão'' trata-se de sugestões de aplicativos, de diversas categorias e finalidades, accessíveis
à PDV, essas sugestões podem ser cadastradas pelo ADS ou sugeridas pelos usuários do DiaVision e aprovadas pelo ADS. A
classe ``Centros de Saúde'' segue o mesmo modelo da anterior, porém, se refere à informações sobre centros de saúde, como
nome, descrição, categoria, contatos e endereço.

A classe ``Autocuidados'' armazena dicas de autocuidado com relação à saúde para os usuários. Porém, diferentemente das duas
classes anteriores, apenas o ADS pode cadastrar novas dicas, os usuários do aplicativo não podem criar sugestões.

Já a classe ``Endereço'', armazena as informações de endereços, como nome, rua, CEP etc, e no momento é utilizada apenas
pela classe ``Centro de Saúde''. As imagens com o logotipo do DiaVision exibidas tanto na tela de autenticação quanto na
tela principal do \emph{dashboard} são arquivos cujas referências ficam na classe ``Imagens''.

Por fim, a classe ``Medicamentos'' armazena informações sobre os nomes de medicamentos disponíveis no Brasil, especificamente
o nome de substâncias utilizadas e o nome comercial de cada medicamento. Essas informações são utilizadas para facilitar
o processo para o usuário informar os medicamentos que faz uso no aplicativo DiaVision.

A \autoref{fig_dash_apps_edit} mostra o exemplo de edição de um objeto da classe ``Apps de Visão''. O campo ``verificado''
é utilizado para aprovar as sugestões de \emph{apps} feitas pelos usuários.

\begin{figure}[htb]
    \caption{\label{fig_dash_apps_edit}Página para Edição de Objeto.}
    \begin{center}
        \includegraphics[scale=0.53]{Imagens/desenvolvimento/apps_visao_edit_admin.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

Na \autoref{fig_dash_auto_add}, pode-se visualizar um exemplo de cadastro do objeto ``Autocuidado''.

\begin{figure}[htb]
    \caption{\label{fig_dash_auto_add}Página para Cadastro de Objeto.}
    \begin{center}
        \includegraphics[scale=0.53]{Imagens/desenvolvimento/autocuidados_add_admin.png}
    \end{center}
    \legend{Fonte: Autor.}
\end{figure}

\newpage

\subsection{Aplicativo}